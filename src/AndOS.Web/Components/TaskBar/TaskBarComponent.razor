@using AndOS.Application.Components
@using AndOS.Application.Components.Windows

@inherits AndOSBaseComponent
@namespace AndOS.Web.Components.TaskBar
@inject ILogger<TaskBarComponent> Logger

@if (ProcessManager.Processes.Exists(x => x.Window is not null))
{
    <div id=@IdElement>
        <div id="taskbar_container_content">
            @foreach (var process in ProcessManager.Processes.Where(x => x.Window is not null))
            {
                <WindowTaskBarComponent Process="process" @key=process />
            }
        </div>
    </div>
}

@code {
    protected override void OnInitialized()
    {
        _logger = Logger;
        IdElement = "taskbar_container";

        ProcessManager.OnWindowOpen += refreshAsync;
        ProcessManager.OnWindowClose += refreshAsync;
        ProcessManager.OnWindowFocus += refreshAsync;
        ProcessManager.OnWindowHide += refreshAsync;
        base.OnInitialized();
    }

    public override void Dispose()
    {
        ProcessManager.OnWindowOpen -= refreshAsync;
        ProcessManager.OnWindowClose -= refreshAsync;
        ProcessManager.OnWindowFocus -= refreshAsync;
        ProcessManager.OnWindowHide -= refreshAsync;
        base.Dispose();
    }
}
